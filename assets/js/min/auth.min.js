/* LFInteractive LLC. All Rights Reserved */
(()=>{async function r(){let r="",n="";document.cookie.split(";").forEach(e=>{try{let o=e.split("="),t=o[0].trim(),a=o[1].trim();"username"==t?r=a:"password"==t&&(n=a)}catch{}});let o=await e(r,n,!1);return{success:null==o.error,user:o}}async function e(r,e,o=!0){let t=new FormData;t.append("username",r),t.append("password",e);let a=await fetch("/assets/php/includes/auth.inc.php?c=login",{body:t,method:"POST"}),s={error:"Unknown error has occurred!"};try{s=await a.json()}catch(r){console.error(r)}return n(),o&&null!=s.error&&n(s.error),a.ok&&(document.cookie=`username=${r}; expires=${new Date(3e3,1,1).toLocaleString("GMT")}; path=/panel`,document.cookie=`password=${e}; expires=${new Date(3e3,1,1).toLocaleString("GMT")}; path=/panel`),s}function n(r){null==r?($("p.error").css("display","none"),$("p.error").html("")):($("p.error").css("display",""),$("p.error").html(r))}let o={};window.location.pathname.startsWith("/panel/login")||window.location.pathname.startsWith("/panel/register")?r().then(r=>{r.success&&(window.location.href="/panel/")}):r().then(r=>{r.success?(o=r.user,console.log(`Logged in as ${o.username}`),Array.from($(".username")).forEach(r=>{r.innerText=o.username})):(console.error(r),window.location.href="/panel/login")}),$("#register-form #button-panel .btn").on("click",()=>{!async function(r,o,t){if(o!=t)return void n("Passwords must match");await $.post("/assets/php/includes/auth.inc.php?c=register",{username:r,password:o}),await e(r,o)}($("input#username").val(),$("input#password").val(),$("input#confirm-password").val())}),$("#login-form input").on("keydown",r=>{"Enter"==r.key&&$("#login-form .btn")[0].click()}),$("#login-form .btn").on("click",()=>{e($("#username").val(),$("#password").val()).then(r=>{null!=r.error?($("#login-form .error").css("opacity","1"),$("#login-form .error")[0].innerText=r.error):($("#login-form .error").css("opacity","0"),window.location.href="/panel")})})}).call();