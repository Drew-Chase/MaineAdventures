/* LFInteractive LLC. All Rights Reserved */
function removeCabin(e){$.get(`/assets/php/includes/cabins.inc.php?c=delete&id=${e}`),$(`#${e}`).addClass("delete"),setTimeout(()=>{$(`#${e}`).remove()},1e3)}function uploadCabinImage(e){let a=$(`#${e} .image-preview`),t=document.createElement("input");t.type="file",t.name="image",t.accept="image/jpeg, image/png, image/webp",t.addEventListener("change",()=>{a.addClass("loading"),a.empty().append("<img>");let n=a.find("img"),l=new FormData;l.append("image",t.files[0]),$.ajax({url:`/assets/php/includes/cabins.inc.php?c=upload&id=${e}`,type:"POST",data:l,processData:!1,contentType:!1,success:t=>{console.log(t),setTimeout(()=>{n.attr("src",`/assets/images/cabins/${e}.jpeg?timestamp=${Date.now()}`),a.removeClass("loading")},1e3)},complete:e=>{a.removeClass("loading")}})}),t.click()}function createInputAndUploadGalleryImage(){let e=document.createElement("input");e.type="file",e.name="image",e.accept="image/jpeg, image/png, image/webp",e.multiple=!0,e.addEventListener("change",()=>{uploadGalleryImage(e.files)}),e.click()}async function uploadGalleryImage(e){$("#gallery.dropzone").addClass("loading");try{e=Array.from(e);let a=0;for(const t of e){$(".dropzone.loading .upload-msg p").html(`Uploading (${a} / ${e.length})`);let n=new FormData;n.append("image",t),n.append("id",t.name),await new Promise((e,a)=>{$.ajax({url:"/assets/php/includes/gallery-images.inc.php?c=upload",type:"POST",data:n,processData:!1,contentType:!1,success:e,error:a})}),a++}window.location.reload()}catch(e){console.error("Error uploading files:",e)}$("#gallery.dropzone").removeClass("loading")}function deleteGalleryImage(e){let a=new FormData;a.append("id",e),$.ajax({url:"/assets/php/includes/gallery-images.inc.php?c=delete",type:"POST",data:a,processData:!1,contentType:!1})}(()=>{function e(e,a,t,n,l,s){let i=document.createElement("div");i.classList.add("col","customer-item");let o=document.createElement("div");o.classList.add("row");let r=document.createElement("p");r.classList.add("title"),r.innerText=a;let p=document.createElement("div");p.classList.add("row","buttons");let c=document.createElement("a");c.classList.add("btn","primary"),c.innerText=s?"Check Out":"Check In",c.href=`/panel/checkin.php?id=${e}`;let d=document.createElement("div");return d.classList.add("btn","secondary","dark"),d.innerText="More Info...",$(d).on("click",()=>{window.open(`/panel/itemized.php?id=${e}`,"_blank","width=1280,height=720,toolbar=no,location=no,status=no,menubar=no")}),p.appendChild(c),p.appendChild(d),o.appendChild(r),o.appendChild(p),i.appendChild(o),i}!async function(){let a=await $.get("/assets/php/includes/bookings.inc.php?c=arriving"),t=$(".arrivals");null!=a.message?t.html(`<p>${a.message}</p>`):Array.from(a).forEach(a=>{t.append(e(a.id,a.name,a.email,a.phone,"1"==a.paid,"1"==a.processed))})}(),async function(){let a=await $.get("/assets/php/includes/bookings.inc.php?c=departing"),t=$(".departures");null!=a.message?t.html(`<p>${a.message}</p>`):Array.from(a).forEach(a=>{t.append(e(a.id,a.name,a.email,a.phone,"1"==a.paid,"1"==a.processed))})}(),async function(){let a=await $.get("/assets/php/includes/bookings.inc.php?c=calendar"),t=$(".calendar");if(null!=a.message)t.html(`<p>${a.message}</p>`);else{let n=0;Array.from(a).forEach(a=>{n>5||(t.append(e(a.id,a.name,a.email,a.phone,"1"==a.paid,"1"==a.processed)),n++)})}}();let a=null;$(".nav-item#search-button").on("click",()=>{$(".search-modal").attr("active",!0)}),$(".search-modal").on("click",e=>{$(e.target).hasClass("search-modal")&&$(".search-modal").attr("active",null)}),$(".search-modal input").on("keyup",()=>{let t=$(".search-modal input");null!=a&&clearTimeout(a),a=setTimeout(()=>async function(a){console.log(`Searching for '${a}'`);let t=await $.post("/assets/php/includes/bookings.inc.php?c=search",{query:a}),n=$(".search-results");n.html(""),Array.from(t).forEach(a=>{n.append(e(a.id,a.name,a.email,a.phone,"1"==a.paid,"1"==a.processed))})}(t.val()),1e3),""==t.val()?($(".search-box").attr("focus",null),$(".search-results").attr("focus",null)):($(".search-box").attr("focus",!0),$(".search-results").attr("focus",!0))}),$("#save-cabins").on("click",()=>{null==$("#save-cabins").attr("disabled")&&$(".cabin-item").each((e,a)=>{let t=(a=$(a)).attr("id"),n=a.find("input#title-input").val(),l=Number.parseInt(a.find("input#price-input").val()),s=Number.parseInt(a.find("input#people-input").val()),i="seasonal"==a.find("toggle.seasonal option[selected]").attr("value"),o=JSON.stringify({id:t,name:n,price:l,people:s,seasonal:i});$("#save-cabins").attr("disabled","true"),$.ajax({url:"/assets/php/includes/cabins.inc.php?c=update",type:"POST",data:o,contentType:"application/json"}),setTimeout(()=>{$("#save-cabins").attr("disabled",null)},5e3)})}),$("#add-cabin").on("click",(function(){let e=JSON.stringify({id:"-1",name:"",price:0,people:0,seasonal:0});$("#save-cabins").attr("disabled","true"),$.ajax({url:"/assets/php/includes/cabins.inc.php?c=update",type:"POST",data:e,contentType:"application/json",complete:e=>{setTimeout(()=>window.location.reload(),1e3)}})}))})(),$("#add-image-button").on("click",e=>{createInputAndUploadGalleryImage()}),$(".gallery-image.admin").on("click",e=>{e.currentTarget.remove(),deleteGalleryImage($(e.currentTarget).find(".title").text())}),$("#gallery").on("dragover",e=>{e.preventDefault(),$("#gallery").addClass("dragover")}),$("#gallery").on("dragleave",e=>{e.preventDefault(),$("#gallery").removeClass("dragover")}),$("#gallery").on("drop",e=>{e.preventDefault(),$("#gallery").removeClass("dragover"),uploadGalleryImage(e.originalEvent.dataTransfer.files)});