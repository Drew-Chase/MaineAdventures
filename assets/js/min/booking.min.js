/* LFInteractive LLC. All Rights Reserved */
(()=>{function e(){let e=$("#cabin-image");$("#cabin-names")[0].innerHTML="";let t=0;l.forEach(n=>{let a=0!=n.seasonal;if(i.isNightly&&!a||!i.isNightly&&a){let a=document.createElement("p");a.id=n.name.replaceAll(" ","-").toLowerCase(),a.innerText=`${n.name} (${n.people} people) - ${c.format(n.price)}/night`,$("#cabin-names")[0].appendChild(a),$(a).attr("index",n.id),$(a).on("click",()=>{let t=`/assets/images/cabins/${n.id}.webp`;Array.from($("#cabin-names p[selected]")).forEach(e=>{$(e).attr("selected",null)}),$(a).attr("selected",""),e.css("background-image",`url('${t}')`),function(e){let t;t=l[e-1],i.cabin.id=t.id,i.cabin.name=t.name,i.cabin.price=t.price,i.cabin.people=t.people}($(a).attr("index")),console.log(i.cabin)}),0==i.cabin.id&&0==t&&(console.log("CLICKED"),a.click())}t++})}function t(t){$(`#${t}`).hasClass("footless")?$("#section-navigation").css("opacity","0"):$("#section-navigation").css("opacity",""),$("#previous").attr("disabled",null),$("#next").attr("disabled",null),$(`#${t}`).css("display",""),$(`#${t}`)[0].scrollIntoView(),o.current=t,o.previous=$(`#${o.current}`).attr("previous"),o.next=$(`#${o.current}`).attr("next"),$("#previous").attr("disabled",""),$("#next").attr("disabled",""),"cabin"==o.current&&0==i.cabin.id&&e(),"success"==o.current&&$("#section-navigation").css("opacity",0),"itemized"==o.current&&($("#sections").css("display","none"),$("#section-navigation").css("display","none"),UpdatePrice(),$(`#${t}`)[0].scrollIntoView()),setTimeout(()=>{o.element.querySelectorAll("section").forEach(e=>{e.id!=t&&$(e).css("display","none")}),null==o.next?$("#next").attr("disabled",""):$("#next").attr("disabled",null),null==o.previous?$("#previous").attr("disabled",""):$("#previous").attr("disabled",null),"contact-information"==o.current&&(a()?$("#next").attr("disabled",null):$("#next").attr("disabled","")),"payment-method"==o.current&&$("#next").attr("disabled",""),"login"==o.current&&$("#next").attr("disabled","")},500)}function n(e){let t=("0"+e.getDate()).slice(-2),n=("0"+(e.getMonth()+1)).slice(-2);return`${e.getFullYear()}-${n}-${t}`}function a(){let e=!1;return 1!=$("#email[interacted]").length||/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test($("#email[interacted]").val())?$("#email[interacted]").removeClass("error"):$("#email[interacted]").addClass("error"),1==$("#fname[interacted]").length&&0==$("#fname[interacted]").val().length?$("#fname[interacted]").addClass("error"):$("#fname[interacted]").removeClass("error"),1==$("#lname[interacted]").length&&0==$("#lname[interacted]").val().length?$("#lname[interacted]").addClass("error"):$("#lname[interacted]").removeClass("error"),1==$("#telephone-number[interacted]").length&&10!=$("#telephone-number[interacted]").val().replaceAll("(","").replaceAll(")","").replaceAll("-","").replaceAll(" ","").length?$("#telephone-number[interacted]").addClass("error"):$("#telephone-number[interacted]").removeClass("error"),Array.from($("#contact-information input")).forEach(t=>{(0==t.value.length||t.classList.contains("error"))&&(e=!0)}),!e}async function r(){let e=new FormData;e.append("name",$("#contact-information #name").val()),e.append("email",$("#contact-information #email").val()),e.append("phone",$("#contact-information #telephone-number").val().replaceAll("(","").replaceAll("-","").replaceAll(")","").replaceAll(" ","")),e.append("adults",i.people.adults),e.append("children",i.people.children),e.append("pets",i.people.pets),e.append("cabin",i.cabin.name),e.append("arrival",`${n(i.arrival)}`),e.append("departure",`${n(i.departure)}`),e.append("seasonal",!i.isNightly),e.append("credits",0);let t=-1,a=await fetch("/assets/php/includes/bookings.inc.php?c=create",{method:"POST",body:e});if(a.ok){try{t=(await a.json()).id}catch{}return-1==t&&(window.location.href="/error/?c=500"),t}{console.error("not ok");let e={error:"Unable to process request at this time!"};try{e=await a.json()}catch{}alert(e.error)}}let l=Array.prototype,i={isNightly:"nightly",cabin:{name:"",price:0,id:0},people:{adults:0,children:0,pets:0},nights:7,arrival:new Date,departure:new Date,card:null,price:0},c=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),o={element:$("#sections")[0],current:"time-span",next:"cabin",previous:null};$("#online-payment-card, #inperson-payment-card").on("click",()=>{$("#previous").attr("disabled",""),$("#next").attr("disabled",""),async function(){let e={adults:i.people.adults,children:i.people.children,pets:i.people.pets,cabin:i.cabin.name,arrival:`${n($("#start-date")[0].valueAsDate)}`,departure:`${n($("#end-date")[0].valueAsDate)}`,seasonal:!i.isNightly},t=await $.post("/panel/itemized.php",e).then();$("#itemized #itemized-content").html(t),$("#itemized").css("display",""),$("#sections").css("display","none"),$("#itemized")[0].scrollIntoView()}()}),$("#inperson-payment-card").on("click",()=>{$("#submit-booking-btn").on("click",async()=>{let e=await r();-1!=e&&(window.location.href=`/booking/complete/?id=${e}`)})}),$("#online-payment-card").on("click",()=>{$("#submit-booking-btn").on("click",async()=>{let e=await r();-1!=e&&(window.location.href=`/booking/pay.php?id=${e}`)})}),$("#cancel-booking-btn").on("click",async()=>{$("#itemized").css("display","none"),$("#sections").css("display",""),$("#sections")[0].scrollIntoView(),t("cabin"),$("#submit-booking-btn").off("click","**")}),$("#time-span .card").on("click",e=>{i.isNightly="Nightly"==e.currentTarget.querySelector(".name").innerText,t(o.next)}),$("#next").on("click",e=>{null==$(e.currentTarget).attr("disabled")&&t(o.next)}),$("#previous").on("click",e=>{null==$(e.currentTarget).attr("disabled")&&t(o.previous)}),$("input[type=tel]").on("keydown",e=>{let t=e.key;"Enter"!=t&&"Backspace"!=t&&(isNaN(t)||isNaN(parseInt(t)))&&e.preventDefault()}),$("input[type=tel]").on("change",e=>{let t=e.currentTarget,n=$(t).val().replace(/\D/g,"");if(""!=n){let e=n.substring(0,3),a=n.substring(3,6),r=n.substring(6,10);$(t).val(`(${e}) ${a}-${r}`)}}),$("#contact-information input").on("focus",e=>$(e.target).attr("interacted","")),$("#contact-information input").on("keyup",()=>{a()?$("#next").attr("disabled",null):$("#next").attr("disabled","")}),$(".btn.print").on("click",()=>Print()),$("section").css("display","none"),t("time-span"),async function(){let e=await fetch("/assets/php/includes/cabins.inc.php?c=get"),t={error:"Unexpected error has occurred"};try{t=await e.json()}catch(e){console.error(e)}e.ok?l=t:alert(t.error)}(),$(".count").on("click",e=>{let t=e.target,n=t.parentElement;Array.from(n.querySelectorAll(".count")).forEach(e=>{$(e).attr("selected",null)}),$(t).attr("selected",""),$(n).attr("value",t.innerText)}),$("#pets .count").on("click",e=>{i.people.pets=Number.parseInt($(e.target.parentElement).attr("value"))}),$("#adults .count").on("click",e=>{i.people.adults=Number.parseInt($(e.target.parentElement).attr("value"))}),$("#children .count").on("click",e=>{i.people.children=Number.parseInt($(e.target.parentElement).attr("value"))}),$("#pets .count")[0].click(),$("#adults .count")[1].click(),$("#children .count")[3].click(),function(){let e=new Date;e.setDate(e.getDate()+5);let t=n(e);$("#start-date")[0].value=t,$("input[type=date]").attr("min",t),e.setDate(e.getDate()+7),$("#end-date")[0].value=n(e),$("#start-date, #end-date").on("change",()=>{let e=new Date($("#calendar-start").attr("date"));e.setDate(value.getDay()+1);let t=new Date($("#calendar-end").attr("date"));t.setDate(value.getDay()+1);let n=Math.round((e-t)/864e5);if(i.nights=n,e>=t){let n=t.getDate()+7,a=t;a.setFullYear(a.getFullYear()+3),createCalendar("end",n.getFullYear(),n.getMonth()+1,e,a,invalidDates=[])}}),$("#calendar-end").on("change",e=>{let t=e.target.value;$("#start-date")[0].max=t})}()}).call();