/* LFInteractive LLC. All Rights Reserved */
(()=>{function e(){let e=$("#cabin-image");$("#cabin-names")[0].innerHTML="";let t=0;i.forEach(n=>{let a=0!=n.seasonal;if(l.isNightly&&!a||!l.isNightly&&a){let a=document.createElement("p");a.id=n.name.replaceAll(" ","-").toLowerCase(),a.innerText=`${n.name} (${n.people} people) - ${c.format(n.price)}/night`,$("#cabin-names")[0].appendChild(a),$(a).attr("index",n.id),$(a).on("click",()=>{let t=`/assets/images/cabins/${n.image}.jpg`;Array.from($("#cabin-names p[selected]")).forEach(e=>{$(e).attr("selected",null)}),$(a).attr("selected",""),e.css("background-image",`url('${t}')`),function(e){let t;t=i[e-1],l.cabin.id=t.id,l.cabin.name=t.name,l.cabin.price=t.price,l.cabin.people=t.people}($(a).attr("index")),console.log(l.cabin)}),0==l.cabin.id&&0==t&&(console.log("CLICKED"),a.click())}t++})}function t(t){$("#section-navigation").css("opacity",""),$("#previous").attr("disabled",null),$("#next").attr("disabled",null),$(`#${t}`).css("display",""),$(`#${t}`)[0].scrollIntoView(),o.current=t,o.previous=$(`#${o.current}`).attr("previous"),o.next=$(`#${o.current}`).attr("next"),$("#previous").attr("disabled",""),$("#next").attr("disabled",""),"cabin"==o.current&&0==l.cabin.id&&e(),"success"==o.current&&$("#section-navigation").css("opacity",0),"itemized"==o.current&&($("#sections").css("display","none"),$("#section-navigation").css("display","none"),UpdatePrice(),$(`#${t}`)[0].scrollIntoView()),setTimeout(()=>{o.element.querySelectorAll("section").forEach(e=>{e.id!=t&&$(e).css("display","none")}),null==o.next?$("#next").attr("disabled",""):$("#next").attr("disabled",null),null==o.previous?$("#previous").attr("disabled",""):$("#previous").attr("disabled",null),"contact-information"==o.current&&(a()?$("#next").attr("disabled",null):$("#next").attr("disabled","")),"payment-method"==o.current&&$("#next").attr("disabled",""),"login"==o.current&&$("#next").attr("disabled","")},500)}function n(e){let t=("0"+e.getDate()).slice(-2),n=("0"+(e.getMonth()+1)).slice(-2);return`${e.getFullYear()}-${n}-${t}`}function a(){let e=!1;return 1!=$("#email[interacted]").length||/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test($("#email[interacted]").val())?$("#email[interacted]").removeClass("error"):$("#email[interacted]").addClass("error"),1==$("#fname[interacted]").length&&0==$("#fname[interacted]").val().length?$("#fname[interacted]").addClass("error"):$("#fname[interacted]").removeClass("error"),1==$("#lname[interacted]").length&&0==$("#lname[interacted]").val().length?$("#lname[interacted]").addClass("error"):$("#lname[interacted]").removeClass("error"),1==$("#telephone-number[interacted]").length&&10!=$("#telephone-number[interacted]").val().replaceAll("(","").replaceAll(")","").replaceAll("-","").replaceAll(" ","").length?$("#telephone-number[interacted]").addClass("error"):$("#telephone-number[interacted]").removeClass("error"),Array.from($("#contact-information input")).forEach(t=>{(0==t.value.length||t.classList.contains("error"))&&(e=!0)}),!e}async function r(){let e=new FormData;e.append("first_name",$("#contact-information #fname").val()),e.append("last_name",$("#contact-information #lname").val()),e.append("email",$("#contact-information #email").val()),e.append("phone",$("#contact-information #telephone-number").val()),e.append("adults",l.people.adults),e.append("children",l.people.children),e.append("pets",l.people.pets),e.append("cabin",l.cabin.name),e.append("arrival",`${n($("#start-date")[0].valueAsDate)} ${$("#start-time").val()}`),e.append("departure",`${n($("#end-date")[0].valueAsDate)} ${$("#end-time").val()}`),e.append("seasonal",!l.isNightly),e.append("credits",0);let t=-1,a=await fetch("/assets/php/bookings.inc.php?c=create",{method:"POST",body:e});if(a.ok){try{t=(await a.json()).id}catch{}return-1==t&&(window.location.href="/error/?c=500"),t}{console.error("not ok");let e={error:"Unable to process request at this time!"};try{e=await a.json()}catch{}alert(e.error)}}let i=Array.prototype,l={isNightly:"nightly",cabin:{name:"",price:0,id:0},people:{adults:0,children:0,pets:0},nights:7,card:null,price:0},c=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),o={element:$("#sections")[0],current:"time-span",next:"cabin",previous:null};$("#online-payment-card, #inperson-payment-card").on("click",()=>{$("#previous").attr("disabled",""),$("#next").attr("disabled",""),async function(){let e={adults:l.people.adults,children:l.people.children,pets:l.people.pets,cabin:l.cabin.name,arrival:`${n($("#start-date")[0].valueAsDate)} ${$("#start-time").val()}`,departure:`${n($("#end-date")[0].valueAsDate)} ${$("#end-time").val()}`,seasonal:!l.isNightly},t=await $.post("/panel/itemized.php",e).then();$("#itemized #itemized-content").html(t),$("#itemized").css("display",""),$("#sections").css("display","none"),$("#itemized")[0].scrollIntoView()}()}),$("#inperson-payment-card").on("click",()=>{$("#submit-booking-btn").on("click",async()=>{let e=await r();window.location.href=`/booking/complete/?id=${e}`})}),$("#online-payment-card").on("click",()=>{$("#submit-booking-btn").on("click",async()=>{let e=await r();window.location.href=`/booking/pay.php?id=${e}`})}),$("#cancel-booking-btn").on("click",async()=>{$("#itemized").css("display","none"),$("#sections").css("display",""),$("#sections")[0].scrollIntoView(),t("cabin"),$("#submit-booking-btn").off("click","**")}),$("#time-span .card").on("click",e=>{l.isNightly="Nightly"==e.currentTarget.querySelector(".name").innerText,t("cabin"),$("#section-navigation").css("opacity","")}),$("#next").on("click",e=>{null==$(e.currentTarget).attr("disabled")&&t(o.next)}),$("#previous").on("click",e=>{null==$(e.currentTarget).attr("disabled")&&t(o.previous)}),$("input[type=tel]").on("keydown",e=>{let t=e.key;"Enter"!=t&&"Backspace"!=t&&(isNaN(t)||isNaN(parseInt(t)))&&e.preventDefault()}),$("input[type=tel]").on("change",e=>{let t=e.currentTarget,n=$(t).val().replace(/\D/g,"");if(""!=n){let e=n.substring(0,3),a=n.substring(3,6),r=n.substring(6,10);$(t).val(`(${e}) ${a}-${r}`)}}),$("#contact-information input").on("focus",e=>$(e.target).attr("interacted","")),$("#contact-information input").on("keyup",()=>{a()?$("#next").attr("disabled",null):$("#next").attr("disabled","")}),$(".btn.print").on("click",()=>Print()),async function(){let e=await fetch("/assets/php/cabins.inc.php?c=get"),t={error:"Unexpected error has occurred"};try{t=await e.json()}catch(e){console.error(e)}e.ok?i=t:alert(t.error)}(),$(".count").on("click",e=>{let t=e.target,n=t.parentElement;Array.from(n.querySelectorAll(".count")).forEach(e=>{$(e).attr("selected",null)}),$(t).attr("selected",""),$(n).attr("value",t.innerText)}),$("#pets .count").on("click",e=>{l.people.pets=Number.parseInt($(e.target.parentElement).attr("value"))}),$("#adults .count").on("click",e=>{l.people.adults=Number.parseInt($(e.target.parentElement).attr("value"))}),$("#children .count").on("click",e=>{l.people.children=Number.parseInt($(e.target.parentElement).attr("value"))}),$("#pets .count")[0].click(),$("#adults .count")[1].click(),$("#children .count")[3].click(),function(){let e=new Date;e.setDate(e.getDate()+5);let t=n(e);$("#start-date")[0].value=t,$("input[type=date]").attr("min",t),e.setDate(e.getDate()+7),$("#end-date")[0].value=n(e),$("#start-date, #end-date").on("change",()=>{let e=$("input#end-date")[0].valueAsDate,t=$("input#start-date")[0].valueAsDate,n=Math.round((e-t)/864e5);l.nights=n}),$("#start-date").on("change",e=>{let t=e.target.value;$("#end-date")[0].min=t;let a=e.target.valueAsDate;a>$("#end-date")[0].valueAsDate&&(a.setDate(a.getDate()+7),$("#end-date").val(n(a)))}),$("#end-date").on("change",e=>{let t=e.target.value;$("#start-date")[0].max=t})}(),t("login")}).call();